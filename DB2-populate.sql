-- usage: mysql -u root db2 < phase2_create_db.sql

-- David Nguyen
-- Karamel Quitayen
-- COMP.3100 Database II
-- Project - Part 2

-- Dat Relational Database Management System


-- users (id, email, password, name, phone)

insert into users (name, email, phone, password) values ("Admin", "admin@mail.com", "1234567890", "password");
insert into users (name, email, phone, password) values ("Principal Smith", "psmith@mail.com", "1234567890", "password1");

-- parents (name, email, phone, password)
insert into users (name, email, phone, password) values ("Bob Jones", "bjones@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Jessica Davis", "jdavis@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("David Nguyen", "dnguyen@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Karamel Quitayen", "kquitayen@mail.com", "1234567890", "password1");

-- students (name, email, phone, password)
insert into users (name, email, phone, password) values ("Sarah Brown", "sbrown@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Peter Miller", "pmiller@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Allan McCombs", "amccombs@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Simon Barber", "sbarber@mail.com", "1234567890","password1");
insert into users (name, email, phone, password) values ("Justin LaGree", "jlagree@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("James Tan", "jtan@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Zack Charlie", "zcharlie@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Fenim Patel", "fpatel@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Cindy Chen", "cchen@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("David Adams", "daddams@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Chris Goulart", "cgoulart@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Byung Kim", "bkim@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Bill Moloney", "bmoloney@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("James Canning", "jcanning@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Ethan McGuire", "ethanmcguire@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Matthew Beliveau", "mbeliveau@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Matt Galat", "mgalat@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Evan Smith", "esmith@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Andrew Yaang", "ayaang@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Donald Trump", "dtrump@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Matthew Perry", "mperry@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Glen Coty", "gcoty@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Steve Barna", "sbarna@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Sarah Currier", "scurrier@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Jeanne Phan", "jphan@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Jasen Ripley", "jripley@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Kristen Soiles", "ksoiles@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Penny Hamourgas", "phamourgas@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Ben Fine", "bfine@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Sean Cummings", "scummings@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Venkat Reddy", "vreddy@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Cameron Napolitano", "cnapolitano@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Mark Pierre", "mpierre@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Mel Carignan", "mcarignan@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Justin Dom", "jdom@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Joel Curry", "jcurry@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Betsy Parsons", "bparsons@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Nichole Sparks", "nsparks@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Levi Berry", "lberry@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Mikasa Ackerman", "mackerman@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Van O'Brien", "vobrien@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Russell Norman", "rnorman@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Percy Jackson", "pjackson@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Annabeth Chase", "achase@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Jason Grace", "jgrace@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Piper McLean", "pmclean@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Leo Valdez", "lvaldez@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Frank Zhang", "fzhang@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Hazel Levesque", "hlevesque@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Nico DiAngelo", "ndiangelo@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Luke Castellan", "lcastellan@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Grover Wood", "gwood@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Harry Potter", "hpotter@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Ron Weasley", "rweasley@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Hermione Granger", "hgranger@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Draco Malfoy", "dmalfoy@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Nick Zimmerman", "nzimmerman@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Frank Malone", "fmalone@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Thelma Harmon", "tharmon@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Wilbur Watkins", "wwatkins@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Sonya Carr", "scarr@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Glen Pratt", "gpratt@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Josh Mitchell", "jmitchell@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Tom Brady", "tbrady@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Julian Edelman", "jedelman@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Rob Gronkowski", "rgronkowski@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Bill Belichick", "bbelichick@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Robert Kraft", "rkraft@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Kyle Van Noy", "kvannoy@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Danny Amendola", "damendola@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Timmy Turner", "tturner@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Jimmy Neutron", "jneutron@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Phineas Flynn", "pflynn@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Ferb Fletcher", "ffletcher@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Isabella Garcia-Shapiro", "ishapiro@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Spongebob Squarepants", "ssquarepants@mail.com", "1234567890", "password1");
insert into users (name, email, phone, password) values ("Patrick Star", "pstar@mail.com", "1234567890", "password1");


-- admins (admin_id)
insert into admins values (1+15);
insert into admins values (2+15);

-- parent (parent_id)
insert into parents values (3+15);
insert into parents values (4+15);
insert into parents values (5+15);
insert into parents values (6+15);

-- (student_id, parent_id, grade)

DELIMITER //
DROP PROCEDURE IF EXISTS createStudent //
CREATE PROCEDURE createStudent()
BEGIN
	DECLARE i INTEGER DEFAULT 22;
	DECLARE p INTEGER DEFAULT 18;
	DECLARE g INTEGER DEFAULT 7;
	
	WHILE i <= 97 DO
		IF p = 22 THEN
			SET p = 18;
		END IF;
		
		IF g = 13 THEN
			SET g = 6;
		END IF;
		
		INSERT INTO students (student_id, parent_id, grade) values (i, p, g);
		SET i = i + 1;
		SET p = p + 1;
		SET g = g + 1;
	END WHILE;
END
//
DELIMITER ;

CALL createStudent();

-- create groups (group_id, name, description, mentee_grade_req, mentor_grade_req)
INSERT INTO `groups` (`name`, `description`, `mentor_grade_req`, `mentee_grade_req`) VALUES ('Grade 6', 6, 9, null);
INSERT INTO `groups` (`name`, `description`, `mentor_grade_req`, `mentee_grade_req`) VALUES ('Grade 7', 7, 10, null);
INSERT INTO `groups` (`name`, `description`, `mentor_grade_req`, `mentee_grade_req`) VALUES ('Grade 8', 8, 11, null);
INSERT INTO `groups` (`name`, `description`, `mentor_grade_req`, `mentee_grade_req`) VALUES ('Grade 9', 9, 12, 6);
INSERT INTO `groups` (`name`, `description`, `mentor_grade_req`, `mentee_grade_req`) VALUES ('Grade 10', 10, null, 7);
INSERT INTO `groups` (`name`, `description`, `mentor_grade_req`, `mentee_grade_req`) VALUES ('Grade 11', 11, null, 8);
INSERT INTO `groups` (`name`, `description`, `mentor_grade_req`, `mentee_grade_req`) VALUES ('Grade 12', 12, null, 9);

	
-- time_slot (time_slot_id, day_of_the_week, start_time, end_time)
insert into time_slot (day_of_the_week, start_time, end_time) values ("Saturday", "16:00:00", "17:00:00"); -- 4pm-5pm
insert into time_slot (day_of_the_week, start_time, end_time) values ("Saturday", "17:00:00", "18:00:00"); -- 5pm-6pm
insert into time_slot (day_of_the_week, start_time, end_time) values ("Saturday", "18:00:00", "19:00:00"); -- 6pm-7pm
insert into time_slot (day_of_the_week, start_time, end_time) values ("Saturday", "19:00:00", "20:00:00"); -- 7pm-8pm
insert into time_slot (day_of_the_week, start_time, end_time) values ("Sunday", "16:00:00", "17:00:00"); -- 4pm-5pm
insert into time_slot (day_of_the_week, start_time, end_time) values ("Sunday", "17:00:00", "18:00:00"); -- 5pm-6pm
insert into time_slot (day_of_the_week, start_time, end_time) values ("Sunday", "18:00:00", "19:00:00"); -- 6pm-7pm
insert into time_slot (day_of_the_week, start_time, end_time) values ("Sunday", "19:00:00", "20:00:00"); -- 7pm-8pm
	
-- meetings (meet_id, meet_name, date, time_slot_id, capacity, announcement, group_id)
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 1", "2020-03-21", 1+6, 0, "Math", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 2", "2020-03-22", 2+6, 0, "English", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 3", "2020-03-28", 3+6, 0, "Math", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 4", "2020-03-29", 4+6, 0, "English", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 5", "2020-04-04", 5+6, 0, "Math", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 6", "2020-04-05", 7+6, 0, "English", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 7", "2020-04-11", 6+6, 0, "English", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 8", "2020-04-12", 8+6, 0, "Math", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 9", "2020-04-18", 1+6, 0, "English", 1);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("6th grade Study Meeting 10", "2020-04-19", 2+6, 0, "Math", 1);

insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 1", "2020-03-21", 1+6, 0, "English", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 2", "2020-03-22", 2+6, 0, "Math", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 3", "2020-03-28", 3+6, 0, "English", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 4", "2020-03-29", 4+6, 0, "Math", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 5", "2020-04-04", 5+6, 0, "English", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 6", "2020-04-05", 6+6, 0, "Math", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 7", "2020-04-11", 7+6, 0, "Math", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 8", "2020-04-12", 8+6, 0, "English", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 9", "2020-04-18", 3+6, 0, "Math", 2);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("7th grade Study Meeting 10", "2020-04-19", 4+6, 0, "English", 2);

insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 1", "2020-03-21", 1+6, 0, "Math", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 2", "2020-03-22", 2+6, 0, "English", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 3", "2020-03-28", 3+6, 0, "Math", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 4", "2020-03-29", 4+6, 0, "English", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 5", "2020-04-04", 5+6, 0, "Math", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 6", "2020-04-05", 6+6, 0, "English", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 7", "2020-04-11", 7+6, 0, "Math", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 8", "2020-04-12", 8+6, 0, "English", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 9", "2020-04-18", 5+6, 0, "Math", 3);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("8th grade Study Meeting 10", "2020-04-19", 6+6, 0, "English", 3);

insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 1", "2020-03-21", 1+6, 0, "English", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 2", "2020-03-22", 2+6, 0, "Math", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 3", "2020-03-28", 3+6, 0, "English", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 4", "2020-03-29", 4+6, 0, "Math", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 5", "2020-04-04", 5+6, 0, "English", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 6", "2020-04-05", 6+6, 0, "Math", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 7", "2020-04-11", 7+6, 0, "English", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 8", "2020-04-12", 8+6, 0, "Math", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 9", "2020-04-18", 7+6, 0, "English", 4);
insert into meetings (meet_name, date, time_slot_id, capacity, announcement, group_id) values ("9th grade Study Meeting 10", "2020-04-19", 8+6, 0, "Math", 4);


-- set mentors (mentor_id) and mentees (mentee_id)
insert into mentors (mentor_id) SELECT student_id FROM students WHERE grade >= 9;
insert into mentees (mentee_id) SELECT student_id FROM students WHERE grade <= 9;

DELIMITER //
DROP PROCEDURE IF EXISTS enrollMentees //
CREATE PROCEDURE enrollMentees()
BEGIN
	DECLARE i INTEGER DEFAULT 100;
	DECLARE j INTEGER DEFAULT 0;
	DECLARE k integer DEFAULT 1;
	DECLARE id INTEGER DEFAULT 0;
	DECLARE c INTEGER DEFAULT -1;
	DECLARE gr INTEGER DEFAULT 6;
	
	WHILE i <= 139 DO
		IF j = 10 THEN
			SET gr = gr + 1;
			SET j = 0;
		END IF;
		
		WHILE k <= 3 DO
			SET c = 1;
			WHILE c > 0 DO
				SELECT student_id INTO id FROM students WHERE grade = gr ORDER BY RAND() LIMIT 1;
				SET c = (SELECT COUNT(*) FROM enroll WHERE mentee_id = id AND meet_id = i);
			END WHILE;
			
			INSERT INTO enroll (meet_id, mentee_id) VALUES (i, id);
			SET k = k + 1;
		END WHILE;
		
		SET k = 1;
		SET j = j + 1;
		SET i = i + 1;
	END WHILE;
END
//
DELIMITER ;

CALL enrollMentees();

DELIMITER //
DROP PROCEDURE IF EXISTS enrollMentors //
CREATE PROCEDURE enrollMentors()
BEGIN
	DECLARE i INTEGER DEFAULT 100;
	DECLARE j INTEGER DEFAULT 0;
	DECLARE k integer DEFAULT 1;
	DECLARE id INTEGER DEFAULT 0;
	DECLARE c INTEGER DEFAULT -1;
	DECLARE req INTEGER DEFAULT 9;
	
	WHILE i <= 139 DO
		IF j = 10 THEN
			SET req = req + 1;
			SET j = 0;
		END IF;
		
		WHILE k <= 2 DO
			SET c = 1;
			WHILE c > 0 DO
				SELECT student_id INTO id FROM students WHERE grade >= req ORDER BY RAND() LIMIT 1;
				SET c = (SELECT COUNT(*) FROM enroll2 WHERE mentor_id = id AND meet_id = i);
			END WHILE;
			
			INSERT INTO enroll2 (meet_id, mentor_id) VALUES (i, id);
			SET k = k + 1;
		END WHILE;
		
		SET k = 1;
		SET j = j + 1;
		SET i = i + 1;
	END WHILE;
END
//
DELIMITER ;

CALL enrollMentors();

-- update meeting capacities
update meetings set capacity = (SELECT COUNT(*) FROM enroll WHERE meet_id = meetings.meet_id) + (SELECT COUNT(*) FROM enroll2 WHERE meet_id = meetings.meet_id);

DELIMITER //
DROP PROCEDURE IF EXISTS createMaterial //
CREATE PROCEDURE createMaterial()
BEGIN
	DECLARE i INTEGER DEFAULT 1;
	
	WHILE i <= 40 DO
		INSERT INTO material (title, author, type, url, assigned_date, notes)
			VALUES (
				CONCAT("Title #", i),
				CONCAT("Author #", i),
				CONCAT("Type #", i),
				CONCAT("www.url", i, ".com"),
				DATE_ADD(CURDATE(), INTERVAL i DAY),
				"this is a note"
			);
		INSERT INTO assign (meet_id, material_id) VALUES (i + 100 - 1, i + 11);
		SET i = i + 1;
	END WHILE;
END
//
DELIMITER ;

CALL createMaterial();
